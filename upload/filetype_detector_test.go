package upload

import (
	"bytes"
	"testing"

	"github.com/stretchr/testify/assert"
)

var svgBytes = []byte(`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 266.88 164.88"><defs><style>.cls-1{isolation:isolate;}.cls-2{fill:#735462;}.cls-3{fill:#6a4c5b;}.cls-3,.cls-4,.cls-5,.cls-6,.cls-7,.cls-8{fill-rule:evenodd;}.cls-4{fill:#ec7752;}.cls-5{fill:#e36b43;}.cls-6{fill:url(#GradientFill_1);}.cls-7{fill:#e77e49;}.cls-10,.cls-11,.cls-8{fill:#fff;}.cls-9{opacity:0.5;mix-blend-mode:multiply;}.cls-11{font-size:42px;font-family:Impact;}</style><linearGradient id="GradientFill_1" x1="297.2" y1="433.73" x2="262.53" y2="396.54" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#e98d47"/><stop offset="1" stop-color="#eea03a"/></linearGradient></defs><g class="cls-1"><g id="图层_1" data-name="图层 1"><rect class="cls-2" x="111.02" y="18.05" width="52.57" height="52.57" rx="2.89"/><path class="cls-3" d="M270.45,378.42h42l.05,26.18.06,26.39h-42l-1.86-.47a2.9,2.9,0,0,1-1.32-2.42V381.31a2.91,2.91,0,0,1,1.38-2.46Z" transform="translate(-156.38 -360.38)"/><path class="cls-4" d="M262.78,379.47l17-4.35,24-6.16a4,4,0,0,1,5.08,4q0,15.78.06,31.6t.07,31.67a3.94,3.94,0,0,1-5.08,4.06l-24.08-6.1-17-4.3c-1.33-.34-2.39-2.21-2.39-4.17V383.64C260.39,381.69,261.45,379.81,262.78,379.47Z" transform="translate(-156.38 -360.38)"/><polygon class="cls-5" points="139.74 10.54 143.33 9.62 143.41 44.17 143.48 78.94 139.89 78.03 139.81 44.17 139.74 10.54"/><path class="cls-6" d="M236.42,372.44l22.52-5,30.79-6.89a5.06,5.06,0,0,1,6.37,5.15l.09,38.87q0,19.47.08,39a5.07,5.07,0,0,1-6.37,5.18L259,441.88l-22.57-5c-1.8-.4-3.23-2.76-3.23-5.27V377.71C233.2,375.22,234.62,372.84,236.42,372.44Z" transform="translate(-156.38 -360.38)"/><path class="cls-7" d="M296.12,370.92l.07,33.62.07,33.86-16.47-4.17-17-4.3c-1.33-.34-2.39-2.21-2.39-4.17V383.64c0-1.95,1.06-3.83,2.39-4.17l17-4.35Z" transform="translate(-156.38 -360.38)"/><path class="cls-8" d="M236,401.3h2.84c.34,0,.62.45.62,1v2.38c0,.79,0,1.58,0,2.37,0,.55-.28,1-.61,1l-1.44-.06-1.4-.07c-.32,0-.58-.46-.58-1v-4.6C235.37,401.74,235.63,401.3,236,401.3Z" transform="translate(-156.38 -360.38)"/><path class="cls-8" d="M236,389.17l1.41-.17,1.47-.18c.35,0,.63.39.62,1l0,2.45,0,2.41c0,.55-.3,1-.64,1l-1.43,0-1.38.05c-.31,0-.57-.41-.57-.94v-4.6C235.37,389.68,235.63,389.21,236,389.17Z" transform="translate(-156.38 -360.38)"/><path class="cls-8" d="M236,377l1.42-.33,1.49-.34c.36-.09.65.34.63.93,0,.85,0,1.68-.06,2.51s0,1.64-.06,2.44c0,.56-.3,1-.65,1.08l-1.43.16-1.36.16c-.31,0-.56-.35-.56-.87v-4.6C235.37,377.62,235.63,377.11,236,377Z" transform="translate(-156.38 -360.38)"/><path class="cls-8" d="M236,420.12l1.41.17,1.47.18c.35,0,.63-.4.62-1,0-.82,0-1.64,0-2.44s0-1.62,0-2.41c0-.56-.3-1-.64-1l-1.43-.05-1.38,0c-.31,0-.57.41-.57.93v4.6C235.37,419.6,235.63,420.08,236,420.12Z" transform="translate(-156.38 -360.38)"/><path class="cls-8" d="M236,432.25l1.42.33,1.49.35c.36.08.65-.34.63-.93l-.06-2.52-.06-2.44c0-.55-.3-1-.65-1.08l-1.43-.16-1.36-.16c-.31,0-.56.36-.56.88v4.59C235.37,431.66,235.63,432.18,236,432.25Z" transform="translate(-156.38 -360.38)"/><path class="cls-8" d="M286,442.43l1,.23,1,.22c.33.08.67.17,1,.24l1,.24c.49.1.88-.47.86-1.27,0-1.17-.05-2.31-.08-3.44s-.06-2.23-.08-3.33c0-.77-.42-1.43-.89-1.48l-1-.12-1-.1-.94-.11-.92-.11c-.43,0-.76.49-.76,1.19v6.28c0,.76.35,1.46.79,1.56Zm0-42.34h3.88c.46,0,.84.62.84,1.37v6.51c0,.75-.38,1.35-.84,1.32l-1,0-1,0-1,0-1,0c-.44,0-.79-.64-.79-1.37v-6.29c0-.73.35-1.33.79-1.33Zm0-16.61,1-.12,1-.11,1-.11,1-.13c.48-.06.86.54.85,1.32,0,1.11,0,2.23,0,3.34s0,2.2,0,3.3c0,.76-.4,1.39-.87,1.41l-1,0-1,0-.95,0-.94,0c-.43,0-.77-.56-.77-1.27v-6.31c0-.73.35-1.39.79-1.44Zm0-16.61,1-.21,1-.24,1-.23c.34-.08.69-.15,1-.24.49-.12.88.47.86,1.27,0,1.17-.05,2.31-.08,3.44s-.06,2.25-.08,3.35c0,.76-.43,1.42-.89,1.47l-1,.12-1,.1c-.32,0-.63.09-.94.12l-.92.1c-.42,0-.76-.49-.76-1.2v-6.29c0-.75.35-1.46.79-1.56Zm0,59,1,.11,1,.12,1,.13c.34,0,.67.08,1,.12s.86-.54.85-1.33c0-1.12,0-2.23,0-3.34s0-2.2,0-3.29c0-.76-.4-1.39-.87-1.4l-1,0-1,0c-.32,0-.63,0-.95,0l-.94,0c-.43,0-.77.56-.77,1.28v6.28C285.17,425.12,285.52,425.77,286,425.83Z" transform="translate(-156.38 -360.38)"/><image class="cls-9" width="1112" height="222" transform="translate(0 96.24) scale(0.24)" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABFgAAADeCAYAAAAJpbRzAAAAC"/><path class="cls-10" d="M162.12,497.77V463.1h11.7v11.67H180V463.1h11.7v34.67H180V484.48h-6.15v13.29Z" transform="translate(-156.38 -360.38)"/><path class="cls-10" d="M198.73,497.77V463.1h11.7v34.67Z" transform="translate(-156.38 -360.38)"/><path class="cls-10" d="M217.33,497.77V475.4q0-6.27,3.34-9.28t10.35-3h7.89v9.69h-6.23a4,4,0,0,0-2.75.83,3.29,3.29,0,0,0-.9,2.53v.71h9.88v9.27H229v11.64Z" transform="translate(-156.38 -360.38)"/><path class="cls-10" d="M245.16,497.77V463.1h11.7v34.67Z" transform="translate(-156.38 -360.38)"/><path class="cls-10" d="M263.76,463.1h11.7v21.62a3.3,3.3,0,0,0,.91,2.56,3.92,3.92,0,0,0,2.75.83h5.52v9.66h-7.18q-7,0-10.35-3t-3.35-9.29Z" transform="translate(-156.38 -360.38)"/><path class="cls-10" d="M287.94,497.77l2.85-28.1a7.73,7.73,0,0,1,2.49-5.32,8.61,8.61,0,0,1,5.81-1.83,8.74,8.74,0,0,1,5,1.36,6.64,6.64,0,0,1,2.68,3.9l2,7.62c.14.58.28,1.27.44,2.06s.32,1.7.49,2.71c.28-1.63.48-2.75.6-3.35s.22-1.07.31-1.39l2-7.65a6.54,6.54,0,0,1,2.67-3.9,8.8,8.8,0,0,1,5-1.36,8.63,8.63,0,0,1,5.81,1.83,7.67,7.67,0,0,1,2.46,5.32l2.93,28.1H320l-1.56-22.46c-.1.9-.23,1.76-.38,2.59s-.3,1.6-.45,2.32l-3.53,13.92a6.19,6.19,0,0,1-1.61,3.1,4.33,4.33,0,0,1-5.58,0,6.36,6.36,0,0,1-1.63-3.1l-3.5-13.92c-.14-.51-.29-1.2-.44-2s-.31-1.81-.47-2.87l-1.53,22.46Z" transform="translate(-156.38 -360.38)"/><image class="cls-9" width="1078" height="115" transform="translate(1.68 137.28) scale(0.24)" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABDYAAABzCAYAAABj"/><path class="cls-10" d="M166.29,513.68h-2.38V503.51H171v1.27h-4.75v3h4V509h-4Z" transform="translate(-156.38 -360.38)"/><path class="cls-10" d="M189.47,503.51v10.17h-2.39V503.51Z" transform="translate(-156.38 -360.38)"/><path class="cls-10" d="M208.5,512.41h5.09v1.27h-7.47V503.51h2.38Z" transform="translate(-156.38 -360.38)"/><path class="cls-10" d="M237.32,506.87l-2.95,7-3.06-7v6.81h-1.69V503.51h2.66l2.45,5.33,2.36-5.33h2.61v10.17h-2.38Z" transform="translate(-156.38 -360.38)"/><path class="cls-10" d="M258.17,511.26l-.85,2.42h-1.64l3.62-10.17H262l3.69,10.17h-2.39l-.92-2.42Zm3.7-1.49-1.6-4.34-1.54,4.34Z" transform="translate(-156.38 -360.38)"/><path class="cls-10" d="M286.94,509.16l3,4.52h-2.77l-3.22-5.5h1.87c1.25,0,1.9-.53,1.93-1.59a2,2,0,0,0-.44-1.34,1.51,1.51,0,0,0-1.18-.49H284v8.9h-2.38V503.51h4.82q3.51,0,3.51,2.94a2.46,2.46,0,0,1-.72,1.81,3.27,3.27,0,0,1-1.47.77,4.75,4.75,0,0,1-.76.15S286.94,509.17,286.94,509.16Z" transform="translate(-156.38 -360.38)"/><path class="cls-10" d="M313.37,513.12q0,.11-.81.36a7.27,7.27,0,0,1-2,.29c-1.81,0-3.08-.45-3.8-1.34a6.64,6.64,0,0,1-1.08-4.18,7.54,7.54,0,0,1,.49-2.58,3.28,3.28,0,0,1,1.41-1.62,5.38,5.38,0,0,1,2.65-.61,9.73,9.73,0,0,1,1.79.15c.53.1.9.18,1.13.25l.45,1.72a5.45,5.45,0,0,0-1-.49,4.91,4.91,0,0,0-1.81-.29,2,2,0,0,0-2,1,5.5,5.5,0,0,0-.5,2.48,13.19,13.19,0,0,0,.14,2,3.25,3.25,0,0,0,.59,1.5,1.69,1.69,0,0,0,1.34.68,6.52,6.52,0,0,0,1.73-.19,4.14,4.14,0,0,0,1.07-.43,2.82,2.82,0,0,0,.34-.23h0Z" transform="translate(-156.38 -360.38)"/><path class="cls-10" d="M335.62,509h-3.53v4.67h-2.38V503.51h2.38v4.23h3.53v-4.23H338v10.17h-2.37Z" transform="translate(-156.38 -360.38)"/><path class="cls-10" d="M357,503.51v10.17h-2.39V503.51Z" transform="translate(-156.38 -360.38)"/><path class="cls-10" d="M377.9,513.79l-5-10.28h2.48l2.9,5.93,2.32-5.93h1.48Z" transform="translate(-156.38 -360.38)"/><path class="cls-10" d="M398.16,503.51h7.14v1.27h-4.75v3h4V509h-4v3.4h4.81v1.27h-7.2Z" transform="translate(-156.38 -360.38)"/><image class="cls-9" width="383" height="286" transform="translate(174.72 94.08) scale(0.24)" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhE"/><text class="cls-11" transform="translate(180.47 137.4) scale(1.05 1)">.TOP</text></g></g></svg>`)

func TestIsSVG(t *testing.T) {
	r := IsSVGImage(svgBytes)
	assert.True(t, r)
}

func TestValidateSVGImage(t *testing.T) {
	r := ValidateSVGImage(svgBytes)
	assert.NoError(t, r)
}

func TestIsTypeStringByReader(t *testing.T) {
	buf := bytes.NewReader(svgBytes)
	r := IsTypeStringByReader(buf, `image`)
	assert.NoError(t, r)
}
